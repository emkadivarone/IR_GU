<!DOCTYPE html>
<html>
<head>
    <title>نمایش کوتاه‌ترین مسیر با OSM</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map {
            height: 600px;
            width: 100%;
        }
    </style>
</head>
<body>
    <h1>نمایش کوتاه‌ترین مسیر بین دو نقطه</h1>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <script>
        // ایجاد نقشه
        var map = L.map('map').setView([35.6892, 51.3890], 13); // تهران به عنوان مرکز نقشه

        // اضافه کردن لایه‌ی OSM
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // ایجاد یک مسیریاب
        var control = L.Routing.control({
            waypoints: [
                L.latLng(35.6892, 51.3890), // نقطه شروع: تهران
                L.latLng(35.6961, 51.4231)  // نقطه پایان: مثلا یک نقطه دیگر در تهران
            ],
            geocoder: L.Control.Geocoder.nominatim(),
            routeWhileDragging: true,
            router: L.Routing.osrmv1({
                serviceUrl: 'https://router.project-osrm.org/route/v1'
            })
        }).addTo(map);

        // امکان انتخاب نقاط جدید با کلیک روی نقشه
        map.on('click', function(e) {
            var container = L.DomUtil.create('div'),
                startBtn = createButton('شروع از این نقطه', container),
                destBtn = createButton('پایان در این نقطه', container);

            L.popup()
                .setContent(container)
                .setLatLng(e.latlng)
                .openOn(map);

            L.DomEvent.on(startBtn, 'click', function() {
                control.spliceWaypoints(0, 1, e.latlng);
                map.closePopup();
            });

            L.DomEvent.on(destBtn, 'click', function() {
                control.spliceWaypoints(control.getWaypoints().length - 1, 1, e.latlng);
                map.closePopup();
            });
        });

        function createButton(label, container) {
            var btn = L.DomUtil.create('button', '', container);
            btn.setAttribute('type', 'button');
            btn.innerHTML = label;
            return btn;
        }
    </script>
</body>
</html>
